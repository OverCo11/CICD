pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                echo 'ğŸ“¥ Clonage du projet Python'
                git branch: 'exercice3', url: 'https://github.com/tom-dab/c>
            }
        }

        stage('Setup Virtualenv & Dependencies') {
            steps {
                sh '''
                    echo "ğŸ”§ CrÃ©ation d'un environnement virtuel"
                    python3 -m venv venv
                    . venv/bin/activate

                    echo "ğŸ“¦ Mise Ã  jour de pip"
                    pip install --upgrade pip

                    echo "ğŸ“¦ Installation des dÃ©pendances du projet"
                    if [ -f "backend/requirements.txt" ]; then
                        pip install -r backend/requirements.txt
                    fi

                    # Installation des plugins pytest
                    pip install pytest pytest-html pytest-cov flask-cors

                    echo "âœ… DÃ©pendances installÃ©es"
                    pip list
                '''
            }
stage('Run Tests') {
            steps {
                sh '''
                    echo "ğŸ§ª ExÃ©cution des tests Python"
                    . venv/bin/activate
                    export PYTHONPATH="${PYTHONPATH}:${PWD}/backend"

                    pytest -v \
                        --junitxml=results.xml \
                        --html=report.html \
                        --self-contained-html \
                        --cov=backend \
                        backend/ || echo "Tests terminÃ©s avec erreurs"
                '''
            }
            post {
                always {
                    script {
                        if (fileExists('results.xml')) { junit 'results.xml>
                        if (fileExists('report.html')) { archiveArtifacts a>
                    }
                }
            }
        }
    }

    post {
        always { echo 'ğŸ§¹ Nettoyage terminÃ©' }
        success { echo 'ğŸ‰ Pipeline Python rÃ©ussie!' }
        failure { echo 'âŒ Ã‰chec de la pipeline Python' }
        unstable { echo 'âš ï¸ Pipeline instable' }
    }
}
        }
